{"version":3,"sources":["../src/colorpicker.js"],"names":["setupColorPicker","$","Pickr","input","colorId","getAttribute","originalColor","convertMessageId","newColorPreviewId","pickr","el","useAsButton","default","theme","swatches","components","preview","opacity","hue","interaction","save","cancel","clear","on","color","newColor","toHEXA","toString","value","show","newColorPreview","css","hide","setColor","setupColorPickers","inputElements","document","querySelectorAll","inputVisibleObserver","IntersectionObserver","entries","self","forEach","entry","isIntersecting","target","unobserve","observe","setupTabInCustomCSSTextarea","delegate","e","keyCode","which","preventDefault","start","selectionStart","end","selectionEnd","val","substring","define","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO: comment\n *\n * @package    tool_genmobilecss\n * @copyright  2020 Alison of Sheesania\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nconst setupColorPicker = ($, Pickr, input) => {\n  const colorId = input.getAttribute(\"name\");\n  const originalColor = input.getAttribute(\"data-color\");\n\n  const convertMessageId = `#convert-message-${colorId}`;\n  const newColorPreviewId = `#new-color-preview-${colorId}`;\n\n  // The color set in the pickr is only \"staged\" - it won't actually be saved and included with the form POST\n  // until the input's value is set to the color.\n  const pickr = new Pickr({\n    el: input,\n    useAsButton: true,\n    default: originalColor,\n    theme: \"classic\",\n    swatches: null,\n    components: {\n      preview: true,\n      opacity: true,\n      hue: true,\n      interaction: {\n        input: true,\n        save: true,\n        cancel: true,\n        clear: true,\n      },\n    },\n  })\n    .on(\"save\", (color) => {\n      if (color) {\n        const newColor = color.toHEXA().toString(0);\n        input.value = newColor;\n        $(convertMessageId).show();\n        const newColorPreview = $(newColorPreviewId);\n        newColorPreview.css(\"background-color\", newColor);\n        newColorPreview.show();\n      }\n      pickr.hide();\n    })\n    .on(\"clear\", () => {\n      pickr.setColor(originalColor);\n      input.value = \"\";\n      $(convertMessageId).hide();\n      $(newColorPreviewId).hide();\n    })\n    .on(\"cancel\", (pickr) => {\n      pickr.hide();\n    });\n};\n\nconst setupColorPickers = ($, Pickr) => {\n  const inputElements = document.querySelectorAll(\".colorpicker-text input\");\n\n  // Only load the color picker when the input first becomes visible. This prevents loading 100+ color pickers all at\n  // once when the page loads\n  let inputVisibleObserver = new IntersectionObserver((entries, self) => {\n    entries.forEach((entry) => {\n      if (entry.isIntersecting) {\n        setupColorPicker($, Pickr, entry.target);\n        self.unobserve(entry.target);\n      }\n    });\n  });\n\n  inputElements.forEach((input) => {\n    inputVisibleObserver.observe(input);\n  });\n};\n\nconst setupTabInCustomCSSTextarea = ($) => {\n  // from https://stackoverflow.com/a/6637396/4954731\n  $(document).delegate(\"#id_customcss\", \"keydown\", function (e) {\n    var keyCode = e.keyCode || e.which;\n\n    if (keyCode == 9) {\n      e.preventDefault();\n      var start = this.selectionStart;\n      var end = this.selectionEnd;\n\n      // set textarea value to: text before caret + tab + text after caret\n      $(this).val(\n        $(this).val().substring(0, start) +\n          \"    \" +\n          $(this).val().substring(end)\n      );\n\n      // put caret at right position again\n      this.selectionStart = this.selectionEnd = start + 4;\n    }\n  });\n};\n\ndefine([\n  \"jquery\",\n  \"https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js\",\n], function ($, Pickr) {\n  return {\n    init: function () {\n      setupColorPickers($, Pickr);\n      setupTabInCustomCSSTextarea($);\n    },\n  };\n});\n"],"file":"colorpicker.min.js"}